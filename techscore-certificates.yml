# Techscore on AWS: Certificate requests
---
AWSTemplateFormatVersion: '2010-09-09'
Description: Certificates for public and private site
Parameters:
  OrgHostname:
    Type: String
    Description: |
      Top-level domain name for organization (i.e. collegesailing.org). For the
      public site, scores. will be prepended. For the private site, ts. instead.

  ScoresSubdomain:
    Type: String
    Description: Subdomain of OrgHostname for public site
    Default: scores
    AllowedPattern: ^[a-z0-9][a-z0-9-]*[a-z0-9]$

  AppSubdomain:
    Type: String
    Description: Subdomain of OrgHostname for the private site
    Default: ts
    AllowedPattern: ^[a-z0-9][a-z0-9-]*[a-z0-9]$

Resources:
  ScoresCertificate:
    Type: AWS::CertificateManager::Certificate
    Properties:
      DomainName:
        Fn::Sub: '${ScoresSubdomain}.${OrgHostname}'
      DomainValidationOptions:
        - DomainName:
            Fn::Sub: '${ScoresSubdomain}.${OrgHostname}'
          ValidationDomain: !Ref OrgHostname

  AppCertificate:
    Type: AWS::CertificateManager::Certificate
    Properties:
      DomainName:
        Fn::Sub: '${AppSubdomain}.${OrgHostname}'
      DomainValidationOptions:
        - DomainName:
            Fn::Sub: '${AppSubdomain}.${OrgHostname}'
          ValidationDomain: !Ref OrgHostname

Outputs:
  ScoresCertificateArn:
    Description: ARN for the created certificate for scores domain.
    Value: !Ref ScoresCertificate
    Export:
      Name: ScoresCertificateArn

  AppCertificateArn:
    Description: ARN for the created certificate for app domain.
    Value: !Ref AppCertificate
    Export:
      Name: AppCertificateArn
